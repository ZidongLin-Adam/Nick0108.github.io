var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)}))},TouchInput.prototype.SetInput=function(t){this.orbitCamera&&this.app.touch&&(t?(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)):(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,h=t.y-i.y;return Math.sqrt(o*o+h*h)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,h=TouchInput.worldDiff,n=this.entity.camera,c=this.orbitCamera.distance;n.screenToWorld(t.x,t.y,c,i),n.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),h.sub2(o,i),this.orbitCamera.pivotPoint.add(h)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var h=o[0];this.orbitCamera.pitch-=(h.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(h.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(h.x,h.y)}else if(2==o.length){var n=this.getPinchDistance(o[0],o[1]),c=n-this.lastPinchDistance;this.lastPinchDistance=n,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=this._targetYaw-this._yaw,e=i%360;this._targetYaw=e>180?this._yaw-(360-e):e<-180?this._yaw+(360+e):this._yaw+e}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,i=function(){t._checkAspectRatio()};window.addEventListener("resize",i,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var e=this.entity.getRotation();this._yaw=this._calcYaw(e),this._pitch=this._clampPitchAngle(this._calcPitch(e,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch;var a=new pc.Vec3;a.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(a.length()),this.frameOnStart&&this.focus(this.focusEntity||this.app.root),this._targetDistance=(this.distanceMax-this.distanceMin)/2+this.distanceMin,this.on("attr:distanceMin",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:distanceMax",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:pitchAngleMin",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:pitchAngleMax",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:focusEntity",function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this.on("attr:frameOnStart",function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this.on("destroy",function(){window.removeEventListener("resize",i,!1)})},OrbitCamera.prototype.SetTargetPos=function(){this._targetYaw=this._yaw,this._pitch=this._targetPitch},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;if(a)for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,o=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",o,!1),this.on("destroy",function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",o,!1)})}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.prototype.SetInput=function(t){t?(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)):(this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this))},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,s=MouseInput.toWorldPoint,e=MouseInput.worldDiff,i=this.entity.camera,n=this.orbitCamera.distance;i.screenToWorld(t.x,t.y,n,o),i.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,s),e.sub2(s,o),this.orbitCamera.pivotPoint.add(e)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown&&this.orbitCamera.enabled?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity,console.warn("d")):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var WebVrUi=pc.createScript("webVrUi");WebVrUi.attributes.add("enterVrWhite",{type:"asset",title:"Enter VR White Asset"}),WebVrUi.attributes.add("enterVrOrange",{type:"asset",title:"Enter VR Orange Asset"}),WebVrUi.attributes.add("infoBoxLifeSpan",{type:"number",default:3,title:"Info Box Life Span"}),WebVrUi.prototype.initialize=function(){this.app.vr&&this.app.vr.display&&(this.app.vr.display.display.bufferScale_=1,this.app.vr.display.on("presentchange",this.onVrPresentChange,this)),this.camera=this.app.root.findByName("Camera"),this.camera2=this.app.root.findByName("Camera2"),this.app.assets.load(this.enterVrWhite),this.app.assets.load(this.enterVrOrange);var i='#vr-button {position: absolute;right: 0px;bottom: 0px;background-image: url("'+this.enterVrWhite.getFileUrl()+'");width: 146px;height: 104px;display: block;background-position: 0px 0px;background-size: 146px 104px; cursor: pointer;}#vr-button:hover {background-image: url("'+this.enterVrOrange.getFileUrl()+'");}#info-box {position: absolute;\tright: 140px;bottom: 26px;display: block;background-color: rgba(0,0,0, 168);color: rgb(218, 218, 218);padding: 5px 10px 5px 10px;max-width: 220px;}#info-box a, #info-box a:hover, #info-box a:visited, #info-box a:active {text-decoration: underline;color: rgb(218, 218, 218);}';this.style=pc.createStyle(i),document.head.appendChild(this.style),this.vrButtonDiv=document.createElement("div"),this.vrButtonDiv.id="vr-button",this.vrButtonDiv.innerHTML="&nbsp",document.body.appendChild(this.vrButtonDiv),this.on("destroy",function(){document.body.removeChild(this.vrButtonDiv),document.head.appendChild(this.style)}),this.infoBoxDiv=document.createElement("div"),this.infoBoxDiv.id="info-box",this.infoBoxLifeTime=0,this.infoBoxShowing=!1,this.vrEntered=!1;var t=this,e=function(){if(t.app.vr&&t.app.vr.display){var i=t.camera.camera.priority>t.camera2.camera.priority?t.camera:t.camera2;t.vrEntered?i.camera.exitVr(function(i){i&&console.warn(i)}):i.camera.enterVr(function(i){i&&console.warn(i)})}else t.infoBoxShowing||(t.app.vr.isSupported?t.infoBoxDiv.innerHTML="No VR display or headset is detected.":t.infoBoxDiv.innerHTML="Sorry, your browser does not support WebVR :(. Please go <a href='https://webvr.info/' target='_blank'>here</a> for more information.",t.infoBoxLifeTime=t.infoBoxLifeSpan,t.infoBoxShowing=!0)};this.vrButtonDiv.addEventListener("click",e,!1),e()},WebVrUi.prototype.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},WebVrUi.prototype.update=function(i){this.infoBoxDiv&&this.infoBoxShowing&&(this.infoBoxLifeTime-=i,this.infoBoxLifeTime<=0&&(this.infoBoxShowing=!1))},WebVrUi.prototype.onVrPresentChange=function(i){i.presenting?(this.isMobile()&&document.body.removeChild(this.vrButtonDiv),this.vrEntered=!0):(this.isMobile()&&document.body.appendChild(this.vrButtonDiv),this.vrEntered=!1)};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","varying vec2 vUv0;","uniform vec2 uResolution;","uniform float uIntensity;","uniform vec4 uColor;","","mat3 G[2];","","const mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );","const mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );","","void main(void)","{","    mat3 I;","    float cnv[2];","    vec3 sample;","","    G[0] = g0;","    G[1] = g1;","","    for (float i = 0.0; i < 3.0; i++)","    {","        for (float j = 0.0; j < 3.0; j++)","        {","            sample = texture2D(uColorBuffer, vUv0 + uResolution * vec2(i - 1.0, j - 1.0)).rgb;","            I[int(i)][int(j)] = length(sample);","         }","    }","","    for (int i=0; i<2; i++)","    {","        float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","        cnv[i] = dp3 * dp3; ","    }","","    gl_FragColor = uIntensity * uColor * vec4(sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));","}"].join("\n")}),this.resolution=new Float32Array(2),this.intensity=1,this.color=new pc.Color(1,1,1,1)};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,i){var o=this.device,n=o.scope;this.resolution[0]=1/t.width,this.resolution[1]=1/t.height,n.resolve("uResolution").setValue(this.resolution),n.resolve("uColorBuffer").setValue(t.colorBuffer),n.resolve("uColor").setValue(this.color.data),n.resolve("uIntensity").setValue(this.intensity),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,i)}}),{EdgeDetectEffect:t}}());var EdgeDetect=pc.createScript("edgeDetect");EdgeDetect.attributes.add("intensity",{type:"number",default:1,min:0,max:2,title:"Intensity"}),EdgeDetect.attributes.add("color",{type:"rgba",default:[.5,.5,.5,1],title:"Color"}),EdgeDetect.prototype.initialize=function(){this.effect=new pc.EdgeDetectEffect(this.app.graphicsDevice),this.effect.intensity=this.intensity,this.effect.color=this.color,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){var o={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:r,fshader:a}),this.resolution=new Float32Array(2)};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,o,r){var a=this.device,t=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,t.resolve("uResolution").setValue(this.resolution),t.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,r)}}),{FxaaEffect:e}}());var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new pc.FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uH;","uniform float uR;","varying vec2 vUv0;","void main() {","vec4 sum = vec4( 0.0 );","float hh = uH * abs( uR - vUv0.x );","sum += texture2D( uColorBuffer, vec2( vUv0.x - 4.0 * hh, vUv0.y ) ) * 0.051;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 3.0 * hh, vUv0.y ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 2.0 * hh, vUv0.y ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 1.0 * hh, vUv0.y ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 1.0 * hh, vUv0.y ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 2.0 * hh, vUv0.y ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 3.0 * hh, vUv0.y ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 4.0 * hh, vUv0.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}),this.focus=.35};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,o){var i=this.device,r=i.scope;r.resolve("uH").setValue(1/e.width),r.resolve("uR").setValue(this.focus),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.shader,o)}}),{HorizontalTiltShiftEffect:e}}());var HorizontalTiltShift=pc.createScript("horizontalTiltShift");HorizontalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,precision:5,title:"Focus"}),HorizontalTiltShift.prototype.initialize=function(){this.effect=new pc.HorizontalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",function(e){this.effect.focus=e},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","float angle = uHue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (uSaturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","}","}"].join("\n")}),this.hue=0,this.saturation=0};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,r){var o=this.device,a=o.scope;a.resolve("uHue").setValue(this.hue),a.resolve("uSaturation").setValue(this.saturation),a.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,r)}}),{HueSaturationEffect:t}}());var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,precision:5,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,precision:5,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new pc.HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform float uAmount;","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","    vec4 color = texture2D(uColorBuffer, vUv0);","    vec3 c = color.rgb;","","    color.r = dot(c, vec3(1.0 - 0.607 * uAmount, 0.769 * uAmount, 0.189 * uAmount));","    color.g = dot(c, vec3(0.349 * uAmount, 1.0 - 0.314 * uAmount, 0.168 * uAmount));","    color.b = dot(c, vec3(0.272 * uAmount, 0.534 * uAmount, 1.0 - 0.869 * uAmount));","","    gl_FragColor = vec4(min(vec3(1.0), color.rgb), color.a);","}"].join("\n")}),this.amount=1};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,o){var i=this.device,n=i.scope;n.resolve("uAmount").setValue(this.amount),n.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(i,e,this.vertexBuffer,this.shader,o)}}),{SepiaEffect:t}}());var Sepia=pc.createScript("sepia");Sepia.attributes.add("amount",{type:"number",default:1,min:0,max:1,title:"Amount"}),Sepia.prototype.initialize=function(){this.effect=new pc.SepiaEffect(this.app.graphicsDevice),this.effect.amount=this.amount,this.on("attr:amount",function(t){this.effect.amount=t},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","vec4 texel = texture2D(uColorBuffer, vUv0);","vec3 luma = vec3(0.299, 0.587, 0.114);","float v = dot(texel.xyz, luma);","gl_FragColor = vec4(v, v, v, texel.w);","}"].join("\n")})};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,i){var o=this.device;o.scope.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{LuminosityEffect:e}}());var Luminosity=pc.createScript("luminosity");Luminosity.prototype.initialize=function(){this.effect=new pc.LuminosityEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uV;","uniform float uR;","varying vec2 vUv0;","void main() {","vec4 sum = vec4( 0.0 );","float vv = uV * abs( uR - vUv0.y );","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}),this.focus=.35};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,v){var i=this.device,r=i.scope;r.resolve("uV").setValue(1/e.height),r.resolve("uR").setValue(this.focus),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.shader,v)}}),{VerticalTiltShiftEffect:e}}());var VerticalTiltShift=pc.createScript("verticalTiltShift");VerticalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,precision:5,title:"Focus"}),VerticalTiltShift.prototype.initialize=function(){this.effect=new pc.VerticalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",function(e){this.effect.focus=e},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){var t={aPosition:pc.SEMANTIC_POSITION},i=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uDarkness;","uniform float uOffset;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec2 uv = (vUv0 - vec2(0.5)) * vec2(uOffset);","    gl_FragColor = vec4(mix(texel.rgb, vec3(1.0 - uDarkness), dot(uv, uv)), texel.a);","}"].join("\n");this.vignetteShader=new pc.Shader(e,{attributes:t,vshader:i,fshader:s}),this.offset=1,this.darkness=1};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e,{render:function(e,t,i){var s=this.device,f=s.scope;f.resolve("uColorBuffer").setValue(e.colorBuffer),f.resolve("uOffset").setValue(this.offset),f.resolve("uDarkness").setValue(this.darkness),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.vignetteShader,i)}}),{VignetteEffect:e}}());var Vignette=pc.createScript("vignette");Vignette.attributes.add("offset",{type:"number",default:1,min:0,precision:5,title:"Offset"}),Vignette.attributes.add("darkness",{type:"number",default:1,precision:5,title:"Darkness"}),Vignette.prototype.initialize=function(){this.effect=new pc.VignetteEffect(this.app.graphicsDevice),this.effect.offset=this.offset,this.effect.darkness=this.darkness,this.on("attr",function(e,t){this.effect[e]=t},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","uniform float uMixRatio;","uniform sampler2D uColorBuffer;","uniform sampler2D uBlendMap;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    vec4 texel2 = texture2D(uBlendMap, vUv0);","    gl_FragColor = mix(texel1, texel2, uMixRatio);","}"].join("\n")}),this.mixRatio=.5,this.blendMap=new pc.Texture(e)};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,i){var o=this.device,n=o.scope;n.resolve("uMixRatio").setValue(this.mixRatio),n.resolve("uColorBuffer").setValue(e.colorBuffer),n.resolve("uBlendMap").setValue(this.blendMap),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{BlendEffect:e}}());var Blend=pc.createScript("blend");Blend.attributes.add("mixRatio",{type:"number",default:1,min:0,max:1,precision:5,title:"Mix Ratio"}),Blend.attributes.add("blendMap",{type:"asset",assetType:"texture",title:"Blend Map"}),Blend.prototype.initialize=function(){this.effect=new pc.BlendEffect(this.app.graphicsDevice),this.effect.mixRatio=this.mixRatio,this.effect.blendMap=this.blendMap.resource;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)}),this.on("attr:mixRatio",function(e){this.effect.mixRatio=e},this),this.on("attr:blendMap",function(e){this.effect.blendMap=e?e.resource:null},this)};pc.extend(pc,function(){function e(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function t(t,r,s,i,l){t[0]=e(0,l),r[0]=0,r[1]=0;var a,u,h=t[0];for(a=0,u=Math.floor(o/2);a<u;a++){var n=e(a+1,l);t[2*a]=n,t[2*a+1]=n,h+=2*n;var f=2*a+1.5;r[4*a]=s*f,r[4*a+1]=i*f,r[4*a+2]=-s*f,r[4*a+3]=-i*f}for(a=0,u=t.length;a<u;a++)t[a]/=h}var o=15,r=function(e){var t={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),i=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+o,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),l=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:i}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:l});var a=e.width,u=e.height;this.targets=[];for(var h=0;h<2;h++){var n=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:a>>1,height:u>>1});n.minFilter=pc.FILTER_LINEAR,n.magFilter=pc.FILTER_LINEAR,n.addressU=pc.ADDRESS_CLAMP_TO_EDGE,n.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var f=new pc.RenderTarget(e,n,{depth:!1});this.targets.push(f)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(o),this.sampleOffsets=new Float32Array(2*o)};return r=pc.inherits(r,pc.PostEffect),r.prototype=pc.extend(r.prototype,{render:function(e,o,r){var s=this.device,i=s.scope;i.resolve("uBloomThreshold").setValue(this.bloomThreshold),i.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),t(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),t(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),i.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),i.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,o,this.vertexBuffer,this.combineShader,r)}}),{BloomEffect:r}}());var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new pc.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",function(e,t){this.effect[e]=t},this),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.needsDepthBuffer=!0,this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uColorBuffer;","uniform sampler2D uDepthMap;","","uniform float uMaxBlur;","uniform float uAperture;","","uniform float uFocus;","uniform float uAspect;","","void main()","{","    vec2 aspectCorrect = vec2( 1.0, uAspect );","","    vec4 depth1 = texture2D( uDepthMap, vUv0 );","","    float factor = depth1.x - uFocus;","","    vec2 dofblur = vec2 ( clamp( factor * uAperture, -uMaxBlur, uMaxBlur ) );","","    vec2 dofblur9 = dofblur * 0.9;","    vec2 dofblur7 = dofblur * 0.7;","    vec2 dofblur4 = dofblur * 0.4;","","    vec4 col;","","    col  = texture2D( uColorBuffer, vUv0 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur7 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur4 );","","    gl_FragColor = col / 41.0;","    gl_FragColor.a = 1.0;","}"].join("\n")}),this.maxBlur=1,this.aperture=.025,this.focus=1,this.aspect=1};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,r,t){var o=this.device,u=o.scope;u.resolve("uMaxBlur").setValue(this.maxBlur),u.resolve("uAperture").setValue(this.aperture),u.resolve("uFocus").setValue(this.focus),u.resolve("uAspect").setValue(this.aspect),u.resolve("uColorBuffer").setValue(e.colorBuffer),u.resolve("uDepthMap").setValue(this.depthMap),pc.drawFullscreenQuad(o,r,this.vertexBuffer,this.shader,t)}}),{BokehEffect:e}}());var Bokeh=pc.createScript("bokeh");Bokeh.attributes.add("maxBlur",{type:"number",default:1,min:0,max:1,precision:5,title:"Max Blur"}),Bokeh.attributes.add("aperture",{type:"number",default:.025,min:0,max:1,precision:5,title:"Aperture"}),Bokeh.attributes.add("focus",{type:"number",default:1,title:"Focus"}),Bokeh.attributes.add("aspect",{type:"number",default:1,title:"Aspect"}),Bokeh.prototype.initialize=function(){this.effect=new pc.BokehEffect(this.app.graphicsDevice),this.effect.maxBlur=this.maxBlur,this.effect.aperture=this.aperture,this.effect.focus=this.focus,this.effect.aspect=this.aspect,this.on("attr",function(e,r){this.effect[e]=r},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(r){r?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","gl_FragColor.rgb += uBrightness;","if (uContrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","}","}"].join("\n")}),this.brightness=0,this.contrast=0};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,r){var s=this.device,i=s.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.shader,r)}}),{BrightnessContrastEffect:t}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,precision:5,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,precision:5,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uH;","uniform float uR;","varying vec2 vUv0;","void main() {","vec4 sum = vec4( 0.0 );","float hh = uH * abs( uR - vUv0.x );","sum += texture2D( uColorBuffer, vec2( vUv0.x - 4.0 * hh, vUv0.y ) ) * 0.051;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 3.0 * hh, vUv0.y ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 2.0 * hh, vUv0.y ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 1.0 * hh, vUv0.y ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 1.0 * hh, vUv0.y ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 2.0 * hh, vUv0.y ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 3.0 * hh, vUv0.y ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 4.0 * hh, vUv0.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}),this.focus=.35};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,o){var i=this.device,r=i.scope;r.resolve("uH").setValue(1/e.width),r.resolve("uR").setValue(this.focus),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.shader,o)}}),{HorizontalTiltShiftEffect:e}}());var HorizontalTiltShift=pc.createScript("horizontalTiltShift");HorizontalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,precision:5,title:"Focus"}),HorizontalTiltShift.prototype.initialize=function(){this.effect=new pc.HorizontalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",function(e){this.effect.focus=e},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","float angle = uHue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (uSaturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","}","}"].join("\n")}),this.hue=0,this.saturation=0};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,r){var o=this.device,a=o.scope;a.resolve("uHue").setValue(this.hue),a.resolve("uSaturation").setValue(this.saturation),a.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,r)}}),{HueSaturationEffect:t}}());var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,precision:5,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,precision:5,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new pc.HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform float uAmount;","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","    vec4 color = texture2D(uColorBuffer, vUv0);","    vec3 c = color.rgb;","","    color.r = dot(c, vec3(1.0 - 0.607 * uAmount, 0.769 * uAmount, 0.189 * uAmount));","    color.g = dot(c, vec3(0.349 * uAmount, 1.0 - 0.314 * uAmount, 0.168 * uAmount));","    color.b = dot(c, vec3(0.272 * uAmount, 0.534 * uAmount, 1.0 - 0.869 * uAmount));","","    gl_FragColor = vec4(min(vec3(1.0), color.rgb), color.a);","}"].join("\n")}),this.amount=1};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,o){var i=this.device,n=i.scope;n.resolve("uAmount").setValue(this.amount),n.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(i,e,this.vertexBuffer,this.shader,o)}}),{SepiaEffect:t}}());var Sepia=pc.createScript("sepia");Sepia.attributes.add("amount",{type:"number",default:1,min:0,max:1,title:"Amount"}),Sepia.prototype.initialize=function(){this.effect=new pc.SepiaEffect(this.app.graphicsDevice),this.effect.amount=this.amount,this.on("attr:amount",function(t){this.effect.amount=t},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","gl_FragColor.rgb += uBrightness;","if (uContrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","}","}"].join("\n")}),this.brightness=0,this.contrast=0};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,r){var s=this.device,i=s.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.shader,r)}}),{BrightnessContrastEffect:t}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,precision:5,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,precision:5,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","vec4 texel = texture2D(uColorBuffer, vUv0);","vec3 luma = vec3(0.299, 0.587, 0.114);","float v = dot(texel.xyz, luma);","gl_FragColor = vec4(v, v, v, texel.w);","}"].join("\n")})};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,i){var o=this.device;o.scope.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{LuminosityEffect:e}}());var Luminosity=pc.createScript("luminosity");Luminosity.prototype.initialize=function(){this.effect=new pc.LuminosityEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uV;","uniform float uR;","varying vec2 vUv0;","void main() {","vec4 sum = vec4( 0.0 );","float vv = uV * abs( uR - vUv0.y );","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}),this.focus=.35};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,v){var i=this.device,r=i.scope;r.resolve("uV").setValue(1/e.height),r.resolve("uR").setValue(this.focus),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.shader,v)}}),{VerticalTiltShiftEffect:e}}());var VerticalTiltShift=pc.createScript("verticalTiltShift");VerticalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,precision:5,title:"Focus"}),VerticalTiltShift.prototype.initialize=function(){this.effect=new pc.VerticalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",function(e){this.effect.focus=e},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){var t={aPosition:pc.SEMANTIC_POSITION},i=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uDarkness;","uniform float uOffset;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec2 uv = (vUv0 - vec2(0.5)) * vec2(uOffset);","    gl_FragColor = vec4(mix(texel.rgb, vec3(1.0 - uDarkness), dot(uv, uv)), texel.a);","}"].join("\n");this.vignetteShader=new pc.Shader(e,{attributes:t,vshader:i,fshader:s}),this.offset=1,this.darkness=1};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e,{render:function(e,t,i){var s=this.device,f=s.scope;f.resolve("uColorBuffer").setValue(e.colorBuffer),f.resolve("uOffset").setValue(this.offset),f.resolve("uDarkness").setValue(this.darkness),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.vignetteShader,i)}}),{VignetteEffect:e}}());var Vignette=pc.createScript("vignette");Vignette.attributes.add("offset",{type:"number",default:1,min:0,precision:5,title:"Offset"}),Vignette.attributes.add("darkness",{type:"number",default:1,precision:5,title:"Darkness"}),Vignette.prototype.initialize=function(){this.effect=new pc.VignetteEffect(this.app.graphicsDevice),this.effect.offset=this.offset,this.effect.darkness=this.darkness,this.on("attr",function(e,t){this.effect[e]=t},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){function e(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function t(t,r,s,i,l){t[0]=e(0,l),r[0]=0,r[1]=0;var a,u,h=t[0];for(a=0,u=Math.floor(o/2);a<u;a++){var n=e(a+1,l);t[2*a]=n,t[2*a+1]=n,h+=2*n;var f=2*a+1.5;r[4*a]=s*f,r[4*a+1]=i*f,r[4*a+2]=-s*f,r[4*a+3]=-i*f}for(a=0,u=t.length;a<u;a++)t[a]/=h}var o=15,r=function(e){var t={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),i=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+o,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),l=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:i}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:l});var a=e.width,u=e.height;this.targets=[];for(var h=0;h<2;h++){var n=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:a>>1,height:u>>1});n.minFilter=pc.FILTER_LINEAR,n.magFilter=pc.FILTER_LINEAR,n.addressU=pc.ADDRESS_CLAMP_TO_EDGE,n.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var f=new pc.RenderTarget(e,n,{depth:!1});this.targets.push(f)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(o),this.sampleOffsets=new Float32Array(2*o)};return r=pc.inherits(r,pc.PostEffect),r.prototype=pc.extend(r.prototype,{render:function(e,o,r){var s=this.device,i=s.scope;i.resolve("uBloomThreshold").setValue(this.bloomThreshold),i.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),t(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),t(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),i.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),i.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,o,this.vertexBuffer,this.combineShader,r)}}),{BloomEffect:r}}());var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new pc.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",function(e,t){this.effect[e]=t},this),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.needsDepthBuffer=!0,this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uColorBuffer;","uniform sampler2D uDepthMap;","","uniform float uMaxBlur;","uniform float uAperture;","","uniform float uFocus;","uniform float uAspect;","","void main()","{","    vec2 aspectCorrect = vec2( 1.0, uAspect );","","    vec4 depth1 = texture2D( uDepthMap, vUv0 );","","    float factor = depth1.x - uFocus;","","    vec2 dofblur = vec2 ( clamp( factor * uAperture, -uMaxBlur, uMaxBlur ) );","","    vec2 dofblur9 = dofblur * 0.9;","    vec2 dofblur7 = dofblur * 0.7;","    vec2 dofblur4 = dofblur * 0.4;","","    vec4 col;","","    col  = texture2D( uColorBuffer, vUv0 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur7 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur4 );","","    gl_FragColor = col / 41.0;","    gl_FragColor.a = 1.0;","}"].join("\n")}),this.maxBlur=1,this.aperture=.025,this.focus=1,this.aspect=1};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,r,t){var o=this.device,u=o.scope;u.resolve("uMaxBlur").setValue(this.maxBlur),u.resolve("uAperture").setValue(this.aperture),u.resolve("uFocus").setValue(this.focus),u.resolve("uAspect").setValue(this.aspect),u.resolve("uColorBuffer").setValue(e.colorBuffer),u.resolve("uDepthMap").setValue(this.depthMap),pc.drawFullscreenQuad(o,r,this.vertexBuffer,this.shader,t)}}),{BokehEffect:e}}());var Bokeh=pc.createScript("bokeh");Bokeh.attributes.add("maxBlur",{type:"number",default:1,min:0,max:1,precision:5,title:"Max Blur"}),Bokeh.attributes.add("aperture",{type:"number",default:.025,min:0,max:1,precision:5,title:"Aperture"}),Bokeh.attributes.add("focus",{type:"number",default:1,title:"Focus"}),Bokeh.attributes.add("aspect",{type:"number",default:1,title:"Aspect"}),Bokeh.prototype.initialize=function(){this.effect=new pc.BokehEffect(this.app.graphicsDevice),this.effect.maxBlur=this.maxBlur,this.effect.aperture=this.aperture,this.effect.focus=this.focus,this.effect.aspect=this.aspect,this.on("attr",function(e,r){this.effect[e]=r},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(r){r?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","uniform float uMixRatio;","uniform sampler2D uColorBuffer;","uniform sampler2D uBlendMap;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    vec4 texel2 = texture2D(uBlendMap, vUv0);","    gl_FragColor = mix(texel1, texel2, uMixRatio);","}"].join("\n")}),this.mixRatio=.5,this.blendMap=new pc.Texture(e)};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,i){var o=this.device,n=o.scope;n.resolve("uMixRatio").setValue(this.mixRatio),n.resolve("uColorBuffer").setValue(e.colorBuffer),n.resolve("uBlendMap").setValue(this.blendMap),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{BlendEffect:e}}());var Blend=pc.createScript("blend");Blend.attributes.add("mixRatio",{type:"number",default:1,min:0,max:1,precision:5,title:"Mix Ratio"}),Blend.attributes.add("blendMap",{type:"asset",assetType:"texture",title:"Blend Map"}),Blend.prototype.initialize=function(){this.effect=new pc.BlendEffect(this.app.graphicsDevice),this.effect.mixRatio=this.mixRatio,this.effect.blendMap=this.blendMap.resource;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)}),this.on("attr:mixRatio",function(e){this.effect.mixRatio=e},this),this.on("attr:blendMap",function(e){this.effect.blendMap=e?e.resource:null},this)};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","varying vec2 vUv0;","uniform vec2 uResolution;","uniform float uIntensity;","uniform vec4 uColor;","","mat3 G[2];","","const mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );","const mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );","","void main(void)","{","    mat3 I;","    float cnv[2];","    vec3 sample;","","    G[0] = g0;","    G[1] = g1;","","    for (float i = 0.0; i < 3.0; i++)","    {","        for (float j = 0.0; j < 3.0; j++)","        {","            sample = texture2D(uColorBuffer, vUv0 + uResolution * vec2(i - 1.0, j - 1.0)).rgb;","            I[int(i)][int(j)] = length(sample);","         }","    }","","    for (int i=0; i<2; i++)","    {","        float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","        cnv[i] = dp3 * dp3; ","    }","","    gl_FragColor = uIntensity * uColor * vec4(sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));","}"].join("\n")}),this.resolution=new Float32Array(2),this.intensity=1,this.color=new pc.Color(1,1,1,1)};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,i){var o=this.device,n=o.scope;this.resolution[0]=1/t.width,this.resolution[1]=1/t.height,n.resolve("uResolution").setValue(this.resolution),n.resolve("uColorBuffer").setValue(t.colorBuffer),n.resolve("uColor").setValue(this.color.data),n.resolve("uIntensity").setValue(this.intensity),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,i)}}),{EdgeDetectEffect:t}}());var EdgeDetect=pc.createScript("edgeDetect");EdgeDetect.attributes.add("intensity",{type:"number",default:1,min:0,max:2,title:"Intensity"}),EdgeDetect.attributes.add("color",{type:"rgba",default:[.5,.5,.5,1],title:"Color"}),EdgeDetect.prototype.initialize=function(){this.effect=new pc.EdgeDetectEffect(this.app.graphicsDevice),this.effect.intensity=this.intensity,this.effect.color=this.color,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform float uAmount;","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","    vec4 color = texture2D(uColorBuffer, vUv0);","    vec3 c = color.rgb;","","    color.r = dot(c, vec3(1.0 - 0.607 * uAmount, 0.769 * uAmount, 0.189 * uAmount));","    color.g = dot(c, vec3(0.349 * uAmount, 1.0 - 0.314 * uAmount, 0.168 * uAmount));","    color.b = dot(c, vec3(0.272 * uAmount, 0.534 * uAmount, 1.0 - 0.869 * uAmount));","","    gl_FragColor = vec4(min(vec3(1.0), color.rgb), color.a);","}"].join("\n")}),this.amount=1};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,o){var i=this.device,n=i.scope;n.resolve("uAmount").setValue(this.amount),n.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(i,e,this.vertexBuffer,this.shader,o)}}),{SepiaEffect:t}}());var Sepia=pc.createScript("sepia");Sepia.attributes.add("amount",{type:"number",default:1,min:0,max:1,title:"Amount"}),Sepia.prototype.initialize=function(){this.effect=new pc.SepiaEffect(this.app.graphicsDevice),this.effect.amount=this.amount,this.on("attr:amount",function(t){this.effect.amount=t},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","vec4 texel = texture2D(uColorBuffer, vUv0);","vec3 luma = vec3(0.299, 0.587, 0.114);","float v = dot(texel.xyz, luma);","gl_FragColor = vec4(v, v, v, texel.w);","}"].join("\n")})};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,i){var o=this.device;o.scope.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{LuminosityEffect:e}}());var Luminosity=pc.createScript("luminosity");Luminosity.prototype.initialize=function(){this.effect=new pc.LuminosityEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uV;","uniform float uR;","varying vec2 vUv0;","void main() {","vec4 sum = vec4( 0.0 );","float vv = uV * abs( uR - vUv0.y );","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}),this.focus=.35};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,v){var i=this.device,r=i.scope;r.resolve("uV").setValue(1/e.height),r.resolve("uR").setValue(this.focus),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.shader,v)}}),{VerticalTiltShiftEffect:e}}());var VerticalTiltShift=pc.createScript("verticalTiltShift");VerticalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,precision:5,title:"Focus"}),VerticalTiltShift.prototype.initialize=function(){this.effect=new pc.VerticalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",function(e){this.effect.focus=e},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){var t={aPosition:pc.SEMANTIC_POSITION},i=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uDarkness;","uniform float uOffset;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec2 uv = (vUv0 - vec2(0.5)) * vec2(uOffset);","    gl_FragColor = vec4(mix(texel.rgb, vec3(1.0 - uDarkness), dot(uv, uv)), texel.a);","}"].join("\n");this.vignetteShader=new pc.Shader(e,{attributes:t,vshader:i,fshader:s}),this.offset=1,this.darkness=1};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e,{render:function(e,t,i){var s=this.device,f=s.scope;f.resolve("uColorBuffer").setValue(e.colorBuffer),f.resolve("uOffset").setValue(this.offset),f.resolve("uDarkness").setValue(this.darkness),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.vignetteShader,i)}}),{VignetteEffect:e}}());var Vignette=pc.createScript("vignette");Vignette.attributes.add("offset",{type:"number",default:1,min:0,precision:5,title:"Offset"}),Vignette.attributes.add("darkness",{type:"number",default:1,precision:5,title:"Darkness"}),Vignette.prototype.initialize=function(){this.effect=new pc.VignetteEffect(this.app.graphicsDevice),this.effect.offset=this.offset,this.effect.darkness=this.darkness,this.on("attr",function(e,t){this.effect[e]=t},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","uniform float uMixRatio;","uniform sampler2D uColorBuffer;","uniform sampler2D uBlendMap;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    vec4 texel2 = texture2D(uBlendMap, vUv0);","    gl_FragColor = mix(texel1, texel2, uMixRatio);","}"].join("\n")}),this.mixRatio=.5,this.blendMap=new pc.Texture(e)};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,i){var o=this.device,n=o.scope;n.resolve("uMixRatio").setValue(this.mixRatio),n.resolve("uColorBuffer").setValue(e.colorBuffer),n.resolve("uBlendMap").setValue(this.blendMap),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{BlendEffect:e}}());var Blend=pc.createScript("blend");Blend.attributes.add("mixRatio",{type:"number",default:1,min:0,max:1,precision:5,title:"Mix Ratio"}),Blend.attributes.add("blendMap",{type:"asset",assetType:"texture",title:"Blend Map"}),Blend.prototype.initialize=function(){this.effect=new pc.BlendEffect(this.app.graphicsDevice),this.effect.mixRatio=this.mixRatio,this.effect.blendMap=this.blendMap.resource;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)}),this.on("attr:mixRatio",function(e){this.effect.mixRatio=e},this),this.on("attr:blendMap",function(e){this.effect.blendMap=e?e.resource:null},this)};pc.extend(pc,function(){function e(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function t(t,r,s,i,l){t[0]=e(0,l),r[0]=0,r[1]=0;var a,u,h=t[0];for(a=0,u=Math.floor(o/2);a<u;a++){var n=e(a+1,l);t[2*a]=n,t[2*a+1]=n,h+=2*n;var f=2*a+1.5;r[4*a]=s*f,r[4*a+1]=i*f,r[4*a+2]=-s*f,r[4*a+3]=-i*f}for(a=0,u=t.length;a<u;a++)t[a]/=h}var o=15,r=function(e){var t={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),i=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+o,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),l=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:i}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:r,fshader:l});var a=e.width,u=e.height;this.targets=[];for(var h=0;h<2;h++){var n=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:a>>1,height:u>>1});n.minFilter=pc.FILTER_LINEAR,n.magFilter=pc.FILTER_LINEAR,n.addressU=pc.ADDRESS_CLAMP_TO_EDGE,n.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var f=new pc.RenderTarget(e,n,{depth:!1});this.targets.push(f)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(o),this.sampleOffsets=new Float32Array(2*o)};return r=pc.inherits(r,pc.PostEffect),r.prototype=pc.extend(r.prototype,{render:function(e,o,r){var s=this.device,i=s.scope;i.resolve("uBloomThreshold").setValue(this.bloomThreshold),i.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),t(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),t(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),i.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),i.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,o,this.vertexBuffer,this.combineShader,r)}}),{BloomEffect:r}}());var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new pc.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",function(e,t){this.effect[e]=t},this),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.needsDepthBuffer=!0,this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uColorBuffer;","uniform sampler2D uDepthMap;","","uniform float uMaxBlur;","uniform float uAperture;","","uniform float uFocus;","uniform float uAspect;","","void main()","{","    vec2 aspectCorrect = vec2( 1.0, uAspect );","","    vec4 depth1 = texture2D( uDepthMap, vUv0 );","","    float factor = depth1.x - uFocus;","","    vec2 dofblur = vec2 ( clamp( factor * uAperture, -uMaxBlur, uMaxBlur ) );","","    vec2 dofblur9 = dofblur * 0.9;","    vec2 dofblur7 = dofblur * 0.7;","    vec2 dofblur4 = dofblur * 0.4;","","    vec4 col;","","    col  = texture2D( uColorBuffer, vUv0 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur7 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur4 );","","    gl_FragColor = col / 41.0;","    gl_FragColor.a = 1.0;","}"].join("\n")}),this.maxBlur=1,this.aperture=.025,this.focus=1,this.aspect=1};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,r,t){var o=this.device,u=o.scope;u.resolve("uMaxBlur").setValue(this.maxBlur),u.resolve("uAperture").setValue(this.aperture),u.resolve("uFocus").setValue(this.focus),u.resolve("uAspect").setValue(this.aspect),u.resolve("uColorBuffer").setValue(e.colorBuffer),u.resolve("uDepthMap").setValue(this.depthMap),pc.drawFullscreenQuad(o,r,this.vertexBuffer,this.shader,t)}}),{BokehEffect:e}}());var Bokeh=pc.createScript("bokeh");Bokeh.attributes.add("maxBlur",{type:"number",default:1,min:0,max:1,precision:5,title:"Max Blur"}),Bokeh.attributes.add("aperture",{type:"number",default:.025,min:0,max:1,precision:5,title:"Aperture"}),Bokeh.attributes.add("focus",{type:"number",default:1,title:"Focus"}),Bokeh.attributes.add("aspect",{type:"number",default:1,title:"Aspect"}),Bokeh.prototype.initialize=function(){this.effect=new pc.BokehEffect(this.app.graphicsDevice),this.effect.maxBlur=this.maxBlur,this.effect.aperture=this.aperture,this.effect.focus=this.focus,this.effect.aspect=this.aspect,this.on("attr",function(e,r){this.effect[e]=r},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(r){r?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","gl_FragColor.rgb += uBrightness;","if (uContrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","}","}"].join("\n")}),this.brightness=0,this.contrast=0};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,r){var s=this.device,i=s.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.shader,r)}}),{BrightnessContrastEffect:t}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,precision:5,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,precision:5,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uH;","uniform float uR;","varying vec2 vUv0;","void main() {","vec4 sum = vec4( 0.0 );","float hh = uH * abs( uR - vUv0.x );","sum += texture2D( uColorBuffer, vec2( vUv0.x - 4.0 * hh, vUv0.y ) ) * 0.051;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 3.0 * hh, vUv0.y ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 2.0 * hh, vUv0.y ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x - 1.0 * hh, vUv0.y ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 1.0 * hh, vUv0.y ) ) * 0.1531;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 2.0 * hh, vUv0.y ) ) * 0.12245;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 3.0 * hh, vUv0.y ) ) * 0.0918;","sum += texture2D( uColorBuffer, vec2( vUv0.x + 4.0 * hh, vUv0.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}),this.focus=.35};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,t,o){var i=this.device,r=i.scope;r.resolve("uH").setValue(1/e.width),r.resolve("uR").setValue(this.focus),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.shader,o)}}),{HorizontalTiltShiftEffect:e}}());var HorizontalTiltShift=pc.createScript("horizontalTiltShift");HorizontalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,precision:5,title:"Focus"}),HorizontalTiltShift.prototype.initialize=function(){this.effect=new pc.HorizontalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",function(e){this.effect.focus=e},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","float angle = uHue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (uSaturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","}","}"].join("\n")}),this.hue=0,this.saturation=0};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,r){var o=this.device,a=o.scope;a.resolve("uHue").setValue(this.hue),a.resolve("uSaturation").setValue(this.saturation),a.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,r)}}),{HueSaturationEffect:t}}());var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,precision:5,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,precision:5,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new pc.HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){var o={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:r,fshader:a}),this.resolution=new Float32Array(2)};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,o,r){var a=this.device,t=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,t.resolve("uResolution").setValue(this.resolution),t.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,r)}}),{FxaaEffect:e}}());var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new pc.FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};var WebVrUi=pc.createScript("webVrUi");WebVrUi.attributes.add("enterVrWhite",{type:"asset",title:"Enter VR White Asset"}),WebVrUi.attributes.add("enterVrOrange",{type:"asset",title:"Enter VR Orange Asset"}),WebVrUi.attributes.add("infoBoxLifeSpan",{type:"number",default:3,title:"Info Box Life Span"}),WebVrUi.prototype.initialize=function(){this.app.vr&&this.app.vr.display&&(this.app.vr.display.display.bufferScale_=1,this.app.vr.display.on("presentchange",this.onVrPresentChange,this)),this.camera=this.app.root.findByName("Camera"),this.camera2=this.app.root.findByName("Camera2"),this.app.assets.load(this.enterVrWhite),this.app.assets.load(this.enterVrOrange);var i='#vr-button {position: absolute;right: 0px;bottom: 0px;background-image: url("'+this.enterVrWhite.getFileUrl()+'");width: 146px;height: 104px;display: block;background-position: 0px 0px;background-size: 146px 104px; cursor: pointer;}#vr-button:hover {background-image: url("'+this.enterVrOrange.getFileUrl()+'");}#info-box {position: absolute;\tright: 140px;bottom: 26px;display: block;background-color: rgba(0,0,0, 168);color: rgb(218, 218, 218);padding: 5px 10px 5px 10px;max-width: 220px;}#info-box a, #info-box a:hover, #info-box a:visited, #info-box a:active {text-decoration: underline;color: rgb(218, 218, 218);}';this.style=pc.createStyle(i),document.head.appendChild(this.style),this.vrButtonDiv=document.createElement("div"),this.vrButtonDiv.id="vr-button",this.vrButtonDiv.innerHTML="&nbsp",document.body.appendChild(this.vrButtonDiv),this.on("destroy",function(){document.body.removeChild(this.vrButtonDiv),document.head.appendChild(this.style)}),this.infoBoxDiv=document.createElement("div"),this.infoBoxDiv.id="info-box",this.infoBoxLifeTime=0,this.infoBoxShowing=!1,this.vrEntered=!1;var t=this,e=function(){if(t.app.vr&&t.app.vr.display){var i=t.camera.camera.priority>t.camera2.camera.priority?t.camera:t.camera2;t.vrEntered?i.camera.exitVr(function(i){i&&console.warn(i)}):i.camera.enterVr(function(i){i&&console.warn(i)})}else t.infoBoxShowing||(t.app.vr.isSupported?t.infoBoxDiv.innerHTML="No VR display or headset is detected.":t.infoBoxDiv.innerHTML="Sorry, your browser does not support WebVR :(. Please go <a href='https://webvr.info/' target='_blank'>here</a> for more information.",t.infoBoxLifeTime=t.infoBoxLifeSpan,t.infoBoxShowing=!0)};this.vrButtonDiv.addEventListener("click",e,!1),e()},WebVrUi.prototype.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},WebVrUi.prototype.update=function(i){this.infoBoxDiv&&this.infoBoxShowing&&(this.infoBoxLifeTime-=i,this.infoBoxLifeTime<=0&&(this.infoBoxShowing=!1))},WebVrUi.prototype.onVrPresentChange=function(i){i.presenting?(this.isMobile()&&document.body.removeChild(this.vrButtonDiv),this.vrEntered=!0):(this.isMobile()&&document.body.appendChild(this.vrButtonDiv),this.vrEntered=!1)};pc.extend(pc,function(){var t=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","varying vec2 vUv0;","uniform vec2 uResolution;","uniform float uIntensity;","uniform vec4 uColor;","","mat3 G[2];","","const mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );","const mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );","","void main(void)","{","    mat3 I;","    float cnv[2];","    vec3 sample;","","    G[0] = g0;","    G[1] = g1;","","    for (float i = 0.0; i < 3.0; i++)","    {","        for (float j = 0.0; j < 3.0; j++)","        {","            sample = texture2D(uColorBuffer, vUv0 + uResolution * vec2(i - 1.0, j - 1.0)).rgb;","            I[int(i)][int(j)] = length(sample);","         }","    }","","    for (int i=0; i<2; i++)","    {","        float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","        cnv[i] = dp3 * dp3; ","    }","","    gl_FragColor = uIntensity * uColor * vec4(sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));","}"].join("\n")}),this.resolution=new Float32Array(2),this.intensity=1,this.color=new pc.Color(1,1,1,1)};return t=pc.inherits(t,pc.PostEffect),t.prototype=pc.extend(t.prototype,{render:function(t,e,i){var o=this.device,n=o.scope;this.resolution[0]=1/t.width,this.resolution[1]=1/t.height,n.resolve("uResolution").setValue(this.resolution),n.resolve("uColorBuffer").setValue(t.colorBuffer),n.resolve("uColor").setValue(this.color.data),n.resolve("uIntensity").setValue(this.intensity),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,i)}}),{EdgeDetectEffect:t}}());var EdgeDetect=pc.createScript("edgeDetect");EdgeDetect.attributes.add("intensity",{type:"number",default:1,min:0,max:2,title:"Intensity"}),EdgeDetect.attributes.add("color",{type:"rgba",default:[.5,.5,.5,1],title:"Color"}),EdgeDetect.prototype.initialize=function(){this.effect=new pc.EdgeDetectEffect(this.app.graphicsDevice),this.effect.intensity=this.intensity,this.effect.color=this.color,this.on("attr",function(t,e){this.effect[t]=e},this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})};pc.extend(pc,function(){var e=function(e){var o={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:r,fshader:a}),this.resolution=new Float32Array(2)};return e=pc.inherits(e,pc.PostEffect),e.prototype=pc.extend(e.prototype,{render:function(e,o,r){var a=this.device,t=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,t.resolve("uResolution").setValue(this.resolution),t.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,r)}}),{FxaaEffect:e}}());var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new pc.FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};var btn=pc.createScript("btn");btn.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),btn.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),btn.attributes.add("textureNormal",{type:"asset",assetType:"texture"}),btn.attributes.add("textureHovered",{type:"asset",assetType:"texture"}),btn.attributes.add("texturePressed",{type:"asset",assetType:"texture"}),btn.attributes.add("pos",{type:"vec2",description:"The coordinate in pixels",placeholder:["x","y"]}),btn.attributes.add("size",{type:"vec2",description:"The size of sprite in pixels",placeholder:["w","h"],default:[128,128]}),btn.attributes.add("anchor",{type:"number",default:0,description:"The anchor of the sprite related to the screen bounds",enum:[{topLeft:0},{topCenter:1},{topRight:2},{Centerleft:3},{CenterCenter:4},{CenterRight:5},{BottomLeft:6},{BottomCenter:7},{BottomRight:8}]}),btn.attributes.add("pivot",{type:"number",default:0,description:"The pivot point of the sprite",enum:[{topLeft:0},{topCenter:1},{topRight:2},{Centerleft:3},{CenterCenter:4},{CenterRight:5},{BottomLeft:6},{BottomCenter:7},{BottomRight:8}]}),btn.attributes.add("event_name",{type:"string"}),btn.prototype.initialize=function(){this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",this.div.innerHTML=this.div.innerHTML.replace("asset-tag-id",this.entity.name),document.body.appendChild(this.div),this.style=document.createElement("style"),this.style.innerHTML=this.css.resource,this.style.innerHTML=this.style.innerHTML.replace("asset-tag-normal",this.textureNormal.getFileUrl()),this.style.innerHTML=this.style.innerHTML.replace("asset-tag-id",this.entity.name),document.head.appendChild(this.style);var t=this.div.querySelector(".button");t.style.backgroundSize=this.size.x+"px "+this.size.y+"px",t.style.width=this.size.x+"px",t.style.height=this.size.y+"px",this.AnchorOffset(t),this.PivotOffset(t),this.btn_click(t),this.on("destroy",function(){document.body.removeChild(this.div),document.head.appendChild(this.style)})},btn.prototype.btn_click=function(t){var e=this;t.addEventListener("click",function(){e.app.fire(e.event_name,e.event_name)},!1)},btn.prototype.update=function(t){},btn.prototype.AnchorOffset=function(t){switch(this.anchor){case 0:t.style.left="0%",t.style.top="0%";break;case 1:t.style.left="50%",t.style.top="0%";break;case 2:t.style.left="100%",t.style.top="0%";break;case 3:t.style.left="0%",t.style.top="50%";break;case 4:t.style.left="50%",t.style.top="50%";break;case 5:t.style.left="100%",t.style.top="50%";break;case 6:t.style.left="0%",t.style.top="100%";break;case 7:t.style.left="50%",t.style.top="100%";break;case 8:t.style.left="100%",t.style.top="100%";break;default:console.error("Wrong anchor: "+this.anchor)}},btn.prototype.PivotOffset=function(t){var e=this.pos.x,s=this.pos.y;switch(this.pivot){case 0:e=this.pos.x,s=this.pos.y;break;case 1:e=this.pos.x-this.size.x/2,s=this.pos.y;break;case 2:e=this.pos.x-this.size.x,s=this.pos.y;break;case 3:e=this.pos.x,s=this.pos.y-this.size.y/2;break;case 4:e=this.pos.x-this.size.x/2,s=this.pos.y-this.size.y/2;break;case 5:e=this.pos.x-this.size.x,s=this.pos.y-this.size.y/2;break;case 6:e=this.pos.x,s=this.pos.y-this.size.y;break;case 7:e=this.pos.x-this.size.x/2,s=this.pos.y-this.size.y;break;case 8:e=this.pos.x-this.size.x,s=this.pos.y-this.size.y;break;default:console.error("Wrong pivot: "+this.pivot)}t.style.transform="translate("+e+"px, "+s+"px)"};var SwitchingMaterials=pc.createScript("switchingMaterials");SwitchingMaterials.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"Materials"}),SwitchingMaterials.prototype.initialize=function(){this.materialIndex=0,console.log(this.entity.children.length)},SwitchingMaterials.prototype.update=function(t){},SwitchingMaterials.prototype.changeToNextMaterial=function(){var t=this.materials[this.materialIndex];this.materialIndex=(this.materialIndex+1)%this.materials.length;for(var i=this.materials[this.materialIndex],e=0;e<this.entity.children.length;e++)if(this.entity.children[e].model&&this.changeMaterial(this.entity.children[e].model.meshInstances,i,t),this.entity.children[e].children.length>=1)for(var a=0;a<this.entity.children[e].children.length;a++)this.entity.children[e].children[a].model&&this.changeMaterial(this.entity.children[e].children[a].model.meshInstances,i,t)},SwitchingMaterials.prototype.changeMaterial=function(t,i,e){if(t)for(var a=0;a<t.length;++a){var n=t[a];n&&n.material.name==e.name&&(n.material=i.resource)}};var Main=pc.createScript("main");Main.prototype.initialize=function(){this.app.on("material",this.onMaterial),this.app.on("fullscreen",this.onFullscreen),this.app.on("lightOnOff",this.onLight),this.app.on("gohome",this.onHome),this.on("destroy",function(){this.app.off("material",this.onMaterial),this.app.off("fullscreen",this.onFullscreen),this.app.off("lightOnOff",this.onLight),this.app.off("gohome",this.onHome)})},Main.prototype.onHome=function(){window.location.href="http://www.realroadc.com"},Main.prototype.onLight=function(){var e=pc.app.root.findByName("Front_Light"),t=pc.app.root.findByName("Rear_Light");e.enabled=!e.enabled,t.enabled=!t.enabled},Main.prototype.update=function(e){},Main.prototype.onFullscreen=function(){pc.app.root.findByName("Root").script.main.toggleFullScreen()},Main.prototype.onMaterial=function(){var e=pc.app.root.findByName("Car");if(e){var t=e.script.switchingMaterials;t&&t.changeToNextMaterial()}},Main.prototype.toggleFullScreen=function(){var e=window.document,t=e.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,o=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?o.call(e):n.call(t)};var RotAnim=pc.createScript("rotAnim"),CLOSED=0,OPEN=1;RotAnim.attributes.add("rotspeed",{type:"number",default:.7,title:"rotate for sec X",description:"  x"}),RotAnim.attributes.add("close",{type:"vec3",default:[0,0,0],title:"close",description:" "}),RotAnim.attributes.add("open",{type:"vec3",default:[0,0,0],title:"open",description:" "}),RotAnim.attributes.add("event_name",{type:"string"}),RotAnim.prototype.initialize=function(){this.rOpen=new pc.Quat(0,0,0,1),this.rClose=new pc.Quat(0,0,0,1),this.AnimPercent=CLOSED,this.AnimState=CLOSED,this.app.on(this.event_name,this.toggle),this.on("destroy",function(){this.app.off(this.event_name,this.toggle)}),this.rOpen.setFromEulerAngles(this.open.x,this.open.y,this.open.z),this.rClose.setFromEulerAngles(this.close.x,this.close.y,this.close.z),this.entity.name=this.event_name},RotAnim.prototype.toggle=function(t){var e=pc.app.root.findByName(t),i=e.script.rotAnim;i.AnimState=i.AnimState===CLOSED?OPEN:CLOSED},RotAnim.prototype.update=function(t){if(this.AnimPercent!=this.AnimState){var e=this.AnimState==CLOSED?-1:1;this.AnimPercent=this.AnimPercent+t*this.rotspeed*e,this.AnimState==CLOSED&&this.AnimPercent<CLOSED&&(this.AnimPercent=CLOSED),this.AnimState==OPEN&&this.AnimPercent>OPEN&&(this.AnimPercent=OPEN);var i=this.rOpen,n=this.rClose,s=this.entity.getLocalRotation();s.slerp(n,i,this.AnimPercent),this.entity.setLocalRotation(s)}};var Hotspot=pc.createScript("hotspot");Hotspot.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),Hotspot.attributes.add("radius",{type:"number",default:.45,title:"Radius"}),Hotspot.attributes.add("opacity",{type:"number",title:"opacity"}),Hotspot.attributes.add("Dir",{type:"number",default:1,title:"Dir"}),Hotspot.attributes.add("fadeDropOff",{type:"number",default:.4,title:"Fade Drop Off",description:"When to start fading out hotspot relative to the camera direction. 1 for when hotspot is directly inline with the camera. 0 for never."}),Hotspot.prototype.initialize=function(){this.hitArea=new pc.BoundingSphere(this.entity.getPosition(),this.radius),this.ray=new pc.Ray,this.defaultForwardDirection=this.entity.forward.clone(),this.directionToCamera=new pc.Vec3,this.sprite=this.entity.children[0],this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.on("destroy",function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this)})),this.on("destroy",function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this)})},Hotspot.prototype.update=function(t){var i=this.cameraEntity.getPosition();this.directionToCamera.sub2(i,this.entity.getPosition()),this.directionToCamera.normalize();var e=this.Dir*this.directionToCamera.dot(this.defaultForwardDirection);if(e<0)this.sprite.enabled&&(this.sprite.enabled=!1);else{this.sprite.enabled||(this.sprite.enabled=!0);for(var o=this.sprite.model.meshInstances,s=pc.math.clamp(e/this.fadeDropOff,0,this.opacity),a=0;a<o.length;++a)o[a].setParameter("material_opacity",s)}},Hotspot.prototype.doRayCast=function(t){this.sprite.enabled&&(this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.cameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.hitArea.intersectsRay(this.ray)&&this.entity.fire("pulse:start"))},Hotspot.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&this.doRayCast(t)},Hotspot.prototype.onTouchStart=function(t){1==t.touches.length&&(this.doRayCast(t.touches[0]),t.event.preventDefault())};var Pulse=pc.createScript("pulse");Pulse.attributes.add("event_name",{type:"string"}),Pulse.attributes.add("event_name2",{type:"string"}),Pulse.attributes.add("pulseTimeSecs",{type:"number",default:2,title:"Pulse Time Secs"}),Pulse.prototype.initialize=function(){this.secsSinceStart=this.pulseTimeSecs+1,this.entity.on("pulse:start",this.onStartEvent,this),this.on("destroy",function(){this.entity.off("pulse:start",this.onStartEvent)})},Pulse.prototype.update=function(t){if(this.secsSinceStart+=t,this.secsSinceStart<=this.pulseTimeSecs){var e=this.secsSinceStart/this.pulseTimeSecs,s=2*Math.abs(e-.5),i=.3*s+.7,n=this.entity.getLocalScale();n.set(i,i,i),this.entity.setLocalScale(n)}},Pulse.prototype.onStartEvent=function(){this.secsSinceStart=0;var t=this;t.app.fire(t.event_name,t.event_name),t.app.fire(t.event_name2,t.event_name2)};var ManagerCamera=pc.createScript("managerCamera");ManagerCamera.attributes.add("camera_In_event_name",{type:"string"}),ManagerCamera.attributes.add("camera_Out_event_name",{type:"string"}),ManagerCamera.attributes.add("entitys",{type:"entity",assetType:"entity",array:!0,title:"entitys"}),ManagerCamera.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.mouseInput=this.entity.script.mouseInput,this.app.on(this.camera_In_event_name,this.camera_In),this.app.on(this.camera_Out_event_name,this.camera_Out),this.on("destroy",function(){this.app.off(this.camera_In_event_name,this.camera_In),this.app.off(this.camera_Out_event_name,this.camera_Out)}),this.app.ManagerCamera=this,setTimeout(function(){var a=pc.app.root.findByName("Camera2");a.script.lookCamera.enabled=!1,a.camera.enabled=!1},100)},ManagerCamera.prototype.update=function(a){this.app.keyboard.wasPressed(pc.KEY_1)&&this.camera_Out("camera_Out_event_name")},ManagerCamera.prototype.camera_Out=function(a){var t=pc.app.root.findByName("Camera"),e=pc.app.root.findByName("Camera2");pc.app.root.findByName("Spot_L_Door_In").enabled=!1,pc.app.root.findByName("left:open").script.rotAnim.AnimState=1,t.camera.enabled=!0,setTimeout(function(){console.warn("camera_Out"),e.script.cameraPath.AnimStart(function(){e.camera.priority=0,e.script.lookCamera.enabled=!1,t.script.mouseInput.SetInput(!0),t.script.touchInput.SetInput(!0),e.camera.enabled=!1})},1e3),setTimeout(function(){var a=pc.app.root.findByName("left:open"),t=a.script.rotAnim;t.AnimState=0,a=pc.app.root.findByName("right:open"),t=a.script.rotAnim,t.AnimState=0,pc.app.root.findByName("Spot_L_Door").enabled=!0,pc.app.root.findByName("Spot_R_Door").enabled=!0},3e3)},ManagerCamera.prototype.camera_In=function(a){var t=pc.app.root.findByName("Camera"),e=pc.app.root.findByName("Camera2");t.script.mouseInput.SetInput(!1),t.script.touchInput.SetInput(!1),e.camera.enabled=!0,pc.app.root.findByName("Spot_L_Door").enabled=!1,pc.app.root.findByName("Spot_R_Door").enabled=!1,t.script.cameraPath.AnimStart(function(){e.script.lookCamera.enabled=!0,e.script.lookCamera._resettarget(),e.camera.priority=6,t.camera.enabled=!1}),setTimeout(function(){var a=pc.app.root.findByName("left:open"),t=a.script.rotAnim;t.AnimState=0,a=pc.app.root.findByName("right:open"),t=a.script.rotAnim,t.AnimState=0,pc.app.root.findByName("Spot_L_Door_In").enabled=!0},2e3)};var CameraPath=pc.createScript("cameraPath");CameraPath.attributes.add("pathRoot",{type:"entity",title:"Path Root"}),CameraPath.attributes.add("duration",{type:"number",default:10,title:"Duration Secs"}),CameraPath.attributes.add("startTime",{type:"number",default:0,title:"Start Time (Secs)",description:"Start the path from a specific point in time"}),CameraPath.prototype.initialize=function(){this.on("attr:pathRoot",function(t,i){t&&(this.createPath(),this.time=0)}),this.on("attr:time",function(t,i){this.time=pc.math.clamp(this.startTime,0,this.duration)}),this.time=pc.math.clamp(this.startTime,0,this.duration),this.lookAt=new pc.Vec3,this.up=new pc.Vec3,this.callback=null},CameraPath.prototype.AnimStart=function(t){this.createPath(),this.bIsStart=!0,this.time=0,this.callback=t},CameraPath.prototype.update=function(t){if(this.bIsStart){this.time+=t,this.time>=this.duration&&(this.time=0,this.bIsStart=!1,this.callback());var i=0;i=this.time/this.duration,this.entity.setPosition(this.px.value(i),this.py.value(i),this.pz.value(i)),this.lookAt.set(this.tx.value(i),this.ty.value(i),this.tz.value(i)),this.up.set(this.ux.value(i),this.uy.value(i),this.uz.value(i)),this.entity.lookAt(this.lookAt,this.up)}},CameraPath.prototype.node_update=function(){var t=this.pathRoot.children,e=0,a=[],h=new pc.Vec3;for(a.push(0),t.unshift(this.entity),i=1;i<t.length;i++){var s=t[i-1],p=t[i];h.sub2(s.getPosition(),p.getPosition()),e+=h.length(),a.push(e)}for(i=0;i<t.length;i++){var r=a[i]/e,u=t[i],n=u.getPosition();this.px.add(r,n.x),this.py.add(r,n.y),this.pz.add(r,n.z);var o=n.clone().add(u.forward);this.tx.add(r,o.x),this.ty.add(r,o.y),this.tz.add(r,o.z);var c=u.up;this.ux.add(r,c.x),this.uy.add(r,c.y),this.uz.add(r,c.z)}},CameraPath.prototype.createPath=function(){var t=pc.CURVE_SMOOTHSTEP;this.px=new pc.Curve,this.px.type=t,this.py=new pc.Curve,this.py.type=t,this.pz=new pc.Curve,this.pz.type=t,this.tx=new pc.Curve,this.tx.type=t,this.ty=new pc.Curve,this.ty.type=t,this.tz=new pc.Curve,this.tz.type=t,this.ux=new pc.Curve,this.ux.type=t,this.uy=new pc.Curve,this.uy.type=t,this.uz=new pc.Curve,this.uz.type=t,this.node_update()};var Billboard=pc.createScript("billboard");Billboard.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),Billboard.prototype.initialize=function(){this.camera=this.cameraEntity},Billboard.prototype.update=function(t){this.entity.setRotation(this.camera.getRotation()),this.entity.rotateLocal(90,0,0)},Billboard.prototype.swap=function(t){};var CameraPath=pc.createScript("cameraPath");CameraPath.attributes.add("pathRoot",{type:"entity",title:"Path Root"}),CameraPath.attributes.add("duration",{type:"number",default:10,title:"Duration Secs"}),CameraPath.attributes.add("startTime",{type:"number",default:0,title:"Start Time (Secs)",description:"Start the path from a specific point in time"}),CameraPath.prototype.initialize=function(){this.on("attr:pathRoot",function(t,i){t&&(this.createPath(),this.time=0)}),this.on("attr:time",function(t,i){this.time=pc.math.clamp(this.startTime,0,this.duration)}),this.time=pc.math.clamp(this.startTime,0,this.duration),this.lookAt=new pc.Vec3,this.up=new pc.Vec3,this.callback=null},CameraPath.prototype.AnimStart=function(t){this.createPath(),this.bIsStart=!0,this.time=0,this.callback=t},CameraPath.prototype.update=function(t){if(this.bIsStart){this.time+=t,this.time>=this.duration&&(this.time=0,this.bIsStart=!1,this.callback());var i=0;i=this.time/this.duration,this.entity.setPosition(this.px.value(i),this.py.value(i),this.pz.value(i)),this.lookAt.set(this.tx.value(i),this.ty.value(i),this.tz.value(i)),this.up.set(this.ux.value(i),this.uy.value(i),this.uz.value(i)),this.entity.lookAt(this.lookAt,this.up)}},CameraPath.prototype.node_update=function(){var t=this.pathRoot.children,e=0,a=[],h=new pc.Vec3;for(a.push(0),t.unshift(this.entity),i=1;i<t.length;i++){var s=t[i-1],p=t[i];h.sub2(s.getPosition(),p.getPosition()),e+=h.length(),a.push(e)}for(i=0;i<t.length;i++){var r=a[i]/e,u=t[i],n=u.getPosition();this.px.add(r,n.x),this.py.add(r,n.y),this.pz.add(r,n.z);var o=n.clone().add(u.forward);this.tx.add(r,o.x),this.ty.add(r,o.y),this.tz.add(r,o.z);var c=u.up;this.ux.add(r,c.x),this.uy.add(r,c.y),this.uz.add(r,c.z)}},CameraPath.prototype.createPath=function(){var t=pc.CURVE_SMOOTHSTEP;this.px=new pc.Curve,this.px.type=t,this.py=new pc.Curve,this.py.type=t,this.pz=new pc.Curve,this.pz.type=t,this.tx=new pc.Curve,this.tx.type=t,this.ty=new pc.Curve,this.ty.type=t,this.tz=new pc.Curve,this.tz.type=t,this.ux=new pc.Curve,this.ux.type=t,this.uy=new pc.Curve,this.uy.type=t,this.uz=new pc.Curve,this.uz.type=t,this.node_update()};var ManagerCamera=pc.createScript("managerCamera");ManagerCamera.attributes.add("camera_In_event_name",{type:"string"}),ManagerCamera.attributes.add("camera_Out_event_name",{type:"string"}),ManagerCamera.attributes.add("entitys",{type:"entity",assetType:"entity",array:!0,title:"entitys"}),ManagerCamera.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.mouseInput=this.entity.script.mouseInput,this.app.on(this.camera_In_event_name,this.camera_In),this.app.on(this.camera_Out_event_name,this.camera_Out),this.on("destroy",function(){this.app.off(this.camera_In_event_name,this.camera_In),this.app.off(this.camera_Out_event_name,this.camera_Out)}),this.app.ManagerCamera=this,setTimeout(function(){var a=pc.app.root.findByName("Camera2");a.script.lookCamera.enabled=!1,a.camera.enabled=!1},100)},ManagerCamera.prototype.update=function(a){this.app.keyboard.wasPressed(pc.KEY_1)&&this.camera_Out("camera_Out_event_name")},ManagerCamera.prototype.camera_Out=function(a){var t=pc.app.root.findByName("Camera"),e=pc.app.root.findByName("Camera2");pc.app.root.findByName("Spot_L_Door_In").enabled=!1,pc.app.root.findByName("left:open").script.rotAnim.AnimState=1,t.camera.enabled=!0,setTimeout(function(){console.warn("camera_Out"),e.script.cameraPath.AnimStart(function(){e.camera.priority=0,e.script.lookCamera.enabled=!1,t.script.mouseInput.SetInput(!0),t.script.touchInput.SetInput(!0),e.camera.enabled=!1})},1e3),setTimeout(function(){var a=pc.app.root.findByName("left:open"),t=a.script.rotAnim;t.AnimState=0,a=pc.app.root.findByName("right:open"),t=a.script.rotAnim,t.AnimState=0,pc.app.root.findByName("Spot_L_Door").enabled=!0,pc.app.root.findByName("Spot_R_Door").enabled=!0},3e3)},ManagerCamera.prototype.camera_In=function(a){var t=pc.app.root.findByName("Camera"),e=pc.app.root.findByName("Camera2");t.script.mouseInput.SetInput(!1),t.script.touchInput.SetInput(!1),e.camera.enabled=!0,pc.app.root.findByName("Spot_L_Door").enabled=!1,pc.app.root.findByName("Spot_R_Door").enabled=!1,t.script.cameraPath.AnimStart(function(){e.script.lookCamera.enabled=!0,e.script.lookCamera._resettarget(),e.camera.priority=6,t.camera.enabled=!1}),setTimeout(function(){var a=pc.app.root.findByName("left:open"),t=a.script.rotAnim;t.AnimState=0,a=pc.app.root.findByName("right:open"),t=a.script.rotAnim,t.AnimState=0,pc.app.root.findByName("Spot_L_Door_In").enabled=!0},2e3)};var Billboard=pc.createScript("billboard");Billboard.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),Billboard.prototype.initialize=function(){this.camera=this.cameraEntity},Billboard.prototype.update=function(t){this.entity.setRotation(this.camera.getRotation()),this.entity.rotateLocal(90,0,0)},Billboard.prototype.swap=function(t){};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity"}),LookCamera.attributes.add("touchLookSensitivity",{type:"number",default:0,title:"Touch Look Sensitivity"}),LookCamera.attributes.add("snappinessFactor",{type:"number",default:.1,title:"Snappiness Factor",description:"Lower is faster"}),LookCamera.prototype.initialize=function(){var t=this;this._tempQuat1=new pc.Quat,this._tempQuat2=new pc.Quat,this._tempVec3_1=new pc.Vec3;var e=this.entity.getLocalRotation();this.ey=this.getYaw(e)*pc.math.RAD_TO_DEG,this.ex=this.getPitch(e,this.ey)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey,this.reset_targetEx=this.ex,this.reset_targetEy=this.ey,this.moved=!1,this.app.mouse.disableContextMenu(),this.lastTouchPosition=new pc.Vec2,this.addEventCallbacks();var o=function(){t._checkAspectRatio()};window.addEventListener("resize",o,!1),this.on("destroy",function(){window.removeEventListener("resize",o,!1),this.app.mouse&&this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseMove,this),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))}),this._checkAspectRatio()},LookCamera.prototype._resettarget=function(){this.targetEx=this.reset_targetEx,this.targetEy=this.reset_targetEy,this.ex=this.reset_targetEx,this.ey=this.reset_targetEy},LookCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,e=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>e},LookCamera.prototype.addEventCallbacks=function(){this.app.mouse&&this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},LookCamera.prototype.update=function(t){var e=1;this.snappinessFactor>0&&(e=t/this.snappinessFactor),this.ex=pc.math.lerp(this.ex,this.targetEx,e),this.ey=pc.math.lerp(this.ey,this.targetEy,e),this.entity.setLocalEulerAngles(this.ex,this.ey,0)},LookCamera.prototype.moveCamera=function(t,e,o){if(!this.moved)return void(this.moved=!0);this.targetEx-=e*o,this.targetEx=pc.math.clamp(this.targetEx,-90,90),this.targetEy-=t*o},LookCamera.prototype.onMouseMove=function(t){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity)},LookCamera.prototype.onTouchStart=function(t){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)},LookCamera.prototype.onTouchMove=function(t){var e=t.touches[0];this.moveCamera(-(e.x-this.lastTouchPosition.x),-(e.y-this.lastTouchPosition.y),this.touchLookSensitivity),this.lastTouchPosition.set(e.x,e.y)},LookCamera.prototype.getYaw=function(){var t=this.entity.forward.clone();return Math.atan2(-t.x,-t.z)},LookCamera.prototype.getPitch=function(t,e){var o=this._tempQuat1,i=this._tempQuat2;i.setFromEulerAngles(0,-e,0),o.mul2(i,t);var s=this._tempVec3_1;return o.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity"}),LookCamera.attributes.add("touchLookSensitivity",{type:"number",default:0,title:"Touch Look Sensitivity"}),LookCamera.attributes.add("snappinessFactor",{type:"number",default:.1,title:"Snappiness Factor",description:"Lower is faster"}),LookCamera.prototype.initialize=function(){var t=this;this._tempQuat1=new pc.Quat,this._tempQuat2=new pc.Quat,this._tempVec3_1=new pc.Vec3;var e=this.entity.getLocalRotation();this.ey=this.getYaw(e)*pc.math.RAD_TO_DEG,this.ex=this.getPitch(e,this.ey)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey,this.reset_targetEx=this.ex,this.reset_targetEy=this.ey,this.moved=!1,this.app.mouse.disableContextMenu(),this.lastTouchPosition=new pc.Vec2,this.addEventCallbacks();var o=function(){t._checkAspectRatio()};window.addEventListener("resize",o,!1),this.on("destroy",function(){window.removeEventListener("resize",o,!1),this.app.mouse&&this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseMove,this),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))}),this._checkAspectRatio()},LookCamera.prototype._resettarget=function(){this.targetEx=this.reset_targetEx,this.targetEy=this.reset_targetEy,this.ex=this.reset_targetEx,this.ey=this.reset_targetEy},LookCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,e=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>e},LookCamera.prototype.addEventCallbacks=function(){this.app.mouse&&this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},LookCamera.prototype.update=function(t){var e=1;this.snappinessFactor>0&&(e=t/this.snappinessFactor),this.ex=pc.math.lerp(this.ex,this.targetEx,e),this.ey=pc.math.lerp(this.ey,this.targetEy,e),this.entity.setLocalEulerAngles(this.ex,this.ey,0)},LookCamera.prototype.moveCamera=function(t,e,o){if(!this.moved)return void(this.moved=!0);this.targetEx-=e*o,this.targetEx=pc.math.clamp(this.targetEx,-90,90),this.targetEy-=t*o},LookCamera.prototype.onMouseMove=function(t){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity)},LookCamera.prototype.onTouchStart=function(t){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)},LookCamera.prototype.onTouchMove=function(t){var e=t.touches[0];this.moveCamera(-(e.x-this.lastTouchPosition.x),-(e.y-this.lastTouchPosition.y),this.touchLookSensitivity),this.lastTouchPosition.set(e.x,e.y)},LookCamera.prototype.getYaw=function(){var t=this.entity.forward.clone();return Math.atan2(-t.x,-t.z)},LookCamera.prototype.getPitch=function(t,e){var o=this._tempQuat1,i=this._tempQuat2;i.setFromEulerAngles(0,-e,0),o.mul2(i,t);var s=this._tempVec3_1;return o.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)};var ChangeScene=pc.createScript("changeScene");ChangeScene.attributes.add("sceneId",{type:"string",default:"0",title:"Scene ID to Load"}),ChangeScene.attributes.add("event_name",{type:"string"}),ChangeScene.prototype.initialize=function(){this.app.on(this.event_name,this.CallEvent),this.on("destroy",function(){this.app.off(this.event_name,this.CallEvent)}),this.entity.name=this.event_name},ChangeScene.prototype.CallEvent=function(e){pc.app.root.findByName(e).script.changeScene.changeScenes()},ChangeScene.prototype.loadScene=function(e,n){var t=e+".json";this.app.loadSceneHierarchy(t,function(e,t){e?console.error(e):n(t)})},ChangeScene.prototype.changeScenes=function(){var e=this.app.root.findByName("Root");e.destroy(),this.loadScene(this.sceneId,function(){e.destroy()})};var ChangeScene=pc.createScript("changeScene");ChangeScene.attributes.add("sceneId",{type:"string",default:"0",title:"Scene ID to Load"}),ChangeScene.attributes.add("event_name",{type:"string"}),ChangeScene.prototype.initialize=function(){this.app.on(this.event_name,this.CallEvent),this.on("destroy",function(){this.app.off(this.event_name,this.CallEvent)}),this.entity.name=this.event_name},ChangeScene.prototype.CallEvent=function(e){pc.app.root.findByName(e).script.changeScene.changeScenes()},ChangeScene.prototype.loadScene=function(e,n){var t=e+".json";this.app.loadSceneHierarchy(t,function(e,t){e?console.error(e):n(t)})},ChangeScene.prototype.changeScenes=function(){var e=this.app.root.findByName("Root");e.destroy(),this.loadScene(this.sceneId,function(){e.destroy()})};var Halo=pc.createScript("halo");Halo.prototype.initialize=function(){this.entity.model.material.blendType=pc.BLEND_ADDITIVEALPHA},Halo.prototype.update=function(t){};